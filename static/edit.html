<HTML>
    <link rel="stylesheet" type="text.css" href="style.css"/>
    <script src="js/jquery-1.10.1.min.js"></script>
    <script>
        function getURLParameter(name) {
            return decodeURI(
                (RegExp(name + '=' + '(.+?)(&|$)').exec(location.search)||[,null])[1]
            );
        }

        $(document).ready(refresh())
        function refresh() {
            $.getJSON('/groups/' + getURLParameter('id'), function (data) {
                $('#name').html(data['name'])
                for (var i = 1; i <= 255; ++i) {
                    var checked = ''
                    if ($.inArray(i, data['channels']) != -1)
                        checked = 'checked'

                
                    $('#table').append($('<div class="toggleButton" id="div_' + i + '">\
                        <label for=channel_"' + i + '">\
                            <input type="checkbox" id="channel_' + i + '" value="' + i + '" ' + checked + '/>\
                        ' + i + '\
                        </label> \
                    </div>'))
                }

                $("input:checkbox").each(function () {
                    $(this).closest("div").css('background-color', this.checked ? '#ffff00' : '#cccccc');
                    $(this).closest("div").click(function () {
                        var checkbox = $(this).children("label").children("input");
                        if (checkbox.prop('checked')) {
                            checkbox.prop('checked', false);
                            $(this).closest("div").css('background-color', '#cccccc')
                        } else {
                            checkbox.prop('checked', true);
                            $(this).closest("div").css('background-color', '#ffff00');
                        }

                        save();

                    });
                });
   
            })
        }

        function save() {
            var selected = new Array()
            $("input:checkbox:checked").each(function () {
                selected.push($(this).val());
            });
           
            url = '/groups/' + getURLParameter('id') + '?channels=' + selected.join();
           
            $.ajax({
                url: url,
                type: 'PUT',
                success: function (data) {
                }
            });
        }
        
        function editName() {
            $('#nameInput').val($('#name').text());
            $('#editNameDiv').show();
            $('#readonlyNameDiv').hide();
        }
        
        function saveName() {
            url = '/groups/' + getURLParameter('id') + '?name=' + $('#nameInput').val();

            $.ajax({
                url: url,
                type: 'PUT',
                success: function(data) {
                    $('#name').text($('#nameInput').val());
                    $('#editNameDiv').hide();
                    $('#readonlyNameDiv').show();
                }
            });
        }

        function cancelName() {
            $('#editNameDiv').hide();
            $('#readonlyNameDiv').show();
        }
        
        function deleteGroup() {
            if (confirm("Are you sure you want to delete this group?")) {
                url = '/groups/' + getURLParameter('id');

                $.ajax({
                    url: url,
                    type: 'DELETE',
                    success: function(data) {
                        window.location.replace('index.html');
                    }
                });
            }
        }
        
    </script>


    <div id="editNameDiv" style="display: none"><input type="text" value="Stage" id="nameInput" style="font-size:48px; width: 200px;float:left"/><img src="Checkmark.png" onclick="saveName()"/><img src="Red_x.png" onclick="cancelName()"/></div>
    <div style="float:right"><input type="button" value="Delete Group" onclick="deleteGroup()"/></div>
    <div id="readonlyNameDiv"><span id="name" style="text-decoration: underline; font-size:48px; float:left" onclick="editName()"></span></div>
    <br/>
    <br/>
    <br/>
    <div id="table" class="columnLayout"></div>
</HTML>